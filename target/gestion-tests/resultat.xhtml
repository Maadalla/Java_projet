<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>ISGA | Résultats</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <h:outputStylesheet library="css" name="styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&amp;display=swap"
        rel="stylesheet" />
    <style>
        .result-container {
            max-width: 800px;
            margin: 3rem auto;
            text-align: center;
        }

        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            margin: 0 auto 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .score-val {
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1;
        }

        .score-total {
            font-size: 1.2rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .success-bg {
            background: linear-gradient(135deg, #dcfce7 0%, #ffffff 100%);
            border: 2px solid #22c55e;
            color: #16a34a;
        }

        .fail-bg {
            background: linear-gradient(135deg, #fee2e2 0%, #ffffff 100%);
            border: 2px solid #ef4444;
            color: #dc2626;
        }

        .result-details {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .detail-item label {
            display: block;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 0.4rem;
            font-weight: 600;
        }

        .detail-item span {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .action-area {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }
    </style>
</h:head>
<h:body style="background: var(--background);">

    <div class="result-container animate-entry">

        <!-- HEADER STATUS -->
        <h:panelGroup rendered="#{testBean.resultat.score ge 10}"> <!-- Seuil 10/score pas pourcentage -->
            <div class="score-circle success-bg">
                <div class="score-val">#{testBean.resultat.score}</div>
                <div class="score-total">/ #{testBean.resultat.totalQuestions}</div>
                <div
                    style="position: absolute; bottom: -15px; background: #22c55e; color: white; padding: 5px 15px; border-radius: 20px; font-weight: 700; font-size: 0.9rem;">
                    ADMIS</div>
            </div>
            <h1 style="color: var(--text-main); margin-bottom: 0.5rem; font-weight: 800;">Félicitations !</h1>
            <p style="color: var(--text-muted); font-size: 1.1rem; max-width: 600px; margin: 0 auto 3rem;">
                Vous avez démontré une excellente maîtrise du sujet. Votre certificat est prêt.
            </p>
        </h:panelGroup>

        <h:panelGroup rendered="#{testBean.resultat.score lt 10}">
            <div class="score-circle fail-bg">
                <div class="score-val">#{testBean.resultat.score}</div>
                <div class="score-total">/ #{testBean.resultat.totalQuestions}</div>
                <div
                    style="position: absolute; bottom: -15px; background: #ef4444; color: white; padding: 5px 15px; border-radius: 20px; font-weight: 700; font-size: 0.9rem;">
                    NON ADMIS</div>
            </div>
            <h1 style="color: var(--text-main); margin-bottom: 0.5rem; font-weight: 800;">Résultat Insuffisant</h1>
            <p style="color: var(--text-muted); font-size: 1.1rem; max-width: 600px; margin: 0 auto 3rem;">
                Ne vous découragez pas. Révisez les concepts et retentez votre chance ultérieurement.
            </p>
        </h:panelGroup>

        <!-- DETAILS CARD -->
        <div class="result-details">
            <div class="detail-item">
                <label>Candidat</label>
                <span>#{testBean.test.candidat.prenom} #{testBean.test.candidat.nom}</span>
            </div>
            <div class="detail-item">
                <label>Date de l'examen</label>
                <span>#{testBean.resultat.dateFormatee}</span>
            </div>
            <div class="detail-item">
                <label>Performance</label>
                <span class="#{testBean.resultat.score ge 10 ? 'text-green-600' : 'text-red-600'}">
                    #{testBean.resultat.pourcentageFormatted}
                </span>
            </div>
            <div class="detail-item">
                <label>Mention</label>
                <span>#{testBean.resultat.mention}</span>
            </div>
        </div>

        <!-- ACTIONS -->
        <h:form>
            <div class="action-area">
                <p:button value="Retour Accueil" outcome="index" icon="pi pi-home" styleClass="ui-button-outlined" />

                <p:commandButton value="Télécharger Mon Certificat" icon="pi pi-download" ajax="false"
                    action="#{testBean.telechargerCertificat}" styleClass="ui-button-success"
                    rendered="#{testBean.resultat.score ge 10}" />
            </div>
        </h:form>

        <div style="margin-top: 3rem; font-size: 0.85rem; color: var(--text-muted); opacity: 0.7;">
            <i class="pi pi-envelope" style="margin-right: 5px;"></i>
            Une copie détaillée a été envoyée à #{testBean.test.candidat.email}
        </div>

    </div>

</h:body>

</html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title>ISGA | RÃ©sultats</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <h:outputStylesheet library="css" name="styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&amp;display=swap" rel="stylesheet" />
</h:head>
<h:body>
    <div class="admin-layout">
        <div class="admin-sidebar">
            <div class="admin-logo">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸš€</div>
                <h2>ISGA</h2>
                <span style="opacity: 0.6; font-size: 0.8rem; letter-spacing: 1px;">MANAGEMENT</span>
            </div>
            <h:form>
                <p:menu style="width: 100%; border: none; background: transparent;">
                    <p:menuitem value="Vue d'ensemble" icon="pi pi-th-large" outcome="dashboard" />
                    <p:menuitem value="Banque de Questions" icon="pi pi-database" outcome="gestion-questions" />
                    <p:menuitem value="Planning &amp; CrÃ©neaux" icon="pi pi-calendar" outcome="gestion-creneaux" />
                    <p:menuitem value="RÃ©sultats &amp; Stats" icon="pi pi-chart-bar" outcome="recherche-resultats"
                        styleClass="active-menu-item" />

                    <p:separator style="background: rgba(255,255,255,0.1); margin: 1rem 0;" />
                    <p:menuitem value="DÃ©connexion" icon="pi pi-power-off" action="#{adminBean.seDeconnecter}"
                        style="color: #fda4af !important;" />
                </p:menu>
            </h:form>
        </div>

        <div class="admin-content">
            <div class="page-header animate-entry">
                <div>
                    <h1 class="page-title">Archives &amp; RÃ©sultats</h1>
                    <p style="color: var(--text-muted);">Consultez la performance des candidats.</p>
                </div>
            </div>

            <!-- SEARCH BAR -->
            <div class="card animate-entry" style="animation-delay: 0.1s; margin-bottom: 2rem; padding: 1.5rem;">
                <h:form>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <span class="ui-input-icon-left" style="flex: 1;">
                            <i class="pi pi-search" />
                            <p:inputText value="#{adminBean.rechercheTerme}"
                                placeholder="Rechercher par nom, prÃ©nom ou email..." style="width: 100%;" />
                        </span>
                        <p:commandButton value="Rechercher" icon="pi pi-filter"
                            action="#{adminBean.rechercherResultats}" update=":resultsForm:resultsTable"
                            styleClass="btn-primary-lg"
                            style="width: auto !important; padding: 0.6rem 1.2rem !important;" />
                    </div>
                </h:form>
            </div>

            <!-- RESULTS TABLE -->
            <div class="card animate-entry" style="animation-delay: 0.2s;">
                <h:form id="resultsForm">
                    <p:dataTable id="resultsTable" var="res" value="#{adminBean.resultats}"
                        emptyMessage="Aucun rÃ©sultat trouvÃ©." paginator="true" rows="10" paginatorPosition="bottom"
                        rowStyleClass="#{res.note ge 10 ? 'success-row' : ''}">

                        <p:column headerText="Date" sortBy="#{res.dateCalcul}" width="160">
                            <h:outputText value="#{res.dateFormatee}" />
                        </p:column>

                        <p:column headerText="Candidat" sortBy="#{res.test.candidat.nom}">
                            <div style="font-weight: 600;">
                                #{res.test.candidat.nom.toUpperCase()} #{res.test.candidat.prenom}
                            </div>
                            <div style="font-size: 0.85rem; opacity: 0.7;">
                                #{res.test.candidat.email}
                            </div>
                        </p:column>

                        <p:column headerText="Score" sortBy="#{res.score}" width="120" style="text-align: center;">
                            <span style="font-weight: 700; font-size: 1.1rem;">#{res.score}</span>
                            <span style="opacity: 0.6;"> / #{res.totalQuestions}</span>
                        </p:column>

                        <p:column headerText="Note / 20" sortBy="#{res.note}" width="120" style="text-align: center;">
                            <div class="result-badge #{res.note ge 10 ? 'pass' : 'fail'}">
                                <h:outputText value="#{res.note}">
                                    <f:convertNumber pattern="#0.0" />
                                </h:outputText>
                            </div>
                        </p:column>

                        <p:column headerText="Mention" width="150" style="text-align: center;">
                            <span
                                style="display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: #f8fafc; border: 1px solid #e2e8f0;">
                                #{res.mention}
                            </span>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </div>

            <style>
                .result-badge {
                    display: inline-block;
                    padding: 6px 14px;
                    border-radius: 8px;
                    font-weight: 700;
                    min-width: 60px;
                }

                .result-badge.pass {
                    background-color: #dcfce7;
                    color: #166534;
                }

                .result-badge.fail {
                    background-color: #fee2e2;
                    color: #991b1b;
                }
            </style>
        </div>
    </div>
</h:body>

</html>